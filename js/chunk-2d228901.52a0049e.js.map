{"version":3,"sources":["webpack:///./src/views/UserEdit.vue","webpack:///./src/views/UserEdit.vue?8d9b"],"names":["class","for","handleSubmit","id","profile","name","type","placeholder","required","image","src","width","height","accept","handleFileChange","disabled","isProcessing","data","undefined","email","computed","beforeRouteUpdate","to","from","next","params","toString","this","currentUser","setUser","$router","push","created","$route","watch","methods","e","files","target","imgURL","window","URL","createObjectURL","fire","title","form","formData","FormData","user","update","userId","statusText","status","Error","console","log","icon","__exports__","render"],"mappings":"oJACOA,MAAM,kB,GAIFA,MAAM,c,EACT,eAA8B,SAAvBC,IAAI,QAAO,QAAI,G,GAYnBD,MAAM,c,EACT,eAAgC,SAAzBC,IAAI,SAAQ,SAAK,G,yEAlB9B,eA2CM,MA3CN,EA2CM,CA1CJ,eAyCO,QAxCJ,SAAM,8CAAe,EAAAC,cAAA,EAAAA,aAAA,qBAAY,sB,CAElC,eAWM,MAXN,EAWM,CAVJ,E,eACA,eAQE,SAPAC,GAAG,O,qDACM,EAAAC,QAAQC,KAAI,IACrBC,KAAK,OACLD,KAAK,OACLL,MAAM,eACNO,YAAY,aACZC,SAAA,I,mBALS,EAAAJ,QAAQC,UASrB,eAkBM,MAlBN,EAkBM,CAjBJ,EAEQ,EAAAD,QAAQK,O,iBADhB,eAMC,O,MAJEC,IAAK,EAAAN,QAAQK,MACdT,MAAM,6BACNW,MAAM,MACNC,OAAO,O,iCAET,eAQE,SAPAT,GAAG,QACHG,KAAK,OACLD,KAAK,QACLQ,OAAO,UACPb,MAAM,oBACL,SAAM,8BAAE,EAAAc,kBAAA,EAAAA,iBAAA,sB,WAKb,eAIgB,UAHdR,KAAK,SACLN,MAAM,kBACLe,SAAU,EAAAC,cACZ,SAAM,M,8IAUE,GACbX,KAAM,WACNY,KAFa,WAGX,MAAO,CACLb,QAAS,CACPD,QAAIe,EACJT,MAAO,GACPJ,KAAM,GACNc,MAAO,IAETH,cAAc,IAGlBI,SAAQ,kBACH,eAAS,CAAC,iBAGfC,kBAjBa,SAiBMC,EAAIC,EAAMC,GAC3B,IAAQrB,EAAOmB,EAAGG,OAAVtB,GACJA,EAAGuB,aAAeC,KAAKC,YAAYzB,GAAGuB,YAI1CC,KAAKE,UACLL,KAJEG,KAAKG,QAAQC,KAAK,CAAE1B,KAAM,eAM9B2B,QA1Ba,WA2BX,IAAQ7B,EAAOwB,KAAKM,OAAOR,OAAnBtB,GACJA,EAAGuB,aAAeC,KAAKC,YAAYzB,GAAGuB,WAI1CC,KAAKE,UAHHF,KAAKG,QAAQC,KAAK,CAAE1B,KAAM,eAM9B6B,MAAO,CACLN,YADK,WAEHD,KAAKE,YAGTM,QAAS,CACPN,QADO,WAEH,MAAsCF,KAAKC,YAAnCvB,EAAR,EAAQA,KAAOI,EAAf,EAAeA,MAAQU,EAAvB,EAAuBA,MAAQhB,EAA/B,EAA+BA,GAC/BwB,KAAKvB,QAAL,iCACKuB,KAAKvB,SADV,IAEED,KACAgB,QACAd,OACAI,WAGNK,iBAXO,SAWUsB,GACf,IAAQC,EAAUD,EAAEE,OAAZD,MACFE,EAASC,OAAOC,IAAIC,gBAAgBL,EAAM,IAChDV,KAAKvB,QAAQK,MAAQ8B,GAEjBrC,aAhBC,SAgBYkC,GAAG,yKAEhB,EAAKhC,QAAQC,KAFG,uBAGlB,OAAMsC,KAAK,CACTrC,KAAM,UACNsC,MAAO,YALS,iCASdC,EAAOT,EAAEE,OACTQ,EAAW,IAAIC,SAASF,GAVV,SAYlB,EAAK7B,cAAe,EAZF,SAakBgC,EAAA,KAAQC,OAAO,CAAEC,OAAQ,EAAK9C,QAAQD,GAAK2C,aAb7D,mBAaV7B,EAbU,EAaVA,KAAOkC,EAbG,EAaHA,WACI,OAAfA,GAAuC,YAAhBlC,EAAKmC,OAdd,uBAeV,IAAIC,MAAMF,GAfA,QAkBlB,EAAKrB,QAAQC,KAAK,CAAE1B,KAAM,OAAQoB,OAAQ,CAAEtB,GAAI,EAAKC,QAAQD,MAlB3C,qDAoBlB,EAAKa,cAAe,EACpBsC,QAAQC,IAAI,QAAZ,MACA,OAAMZ,KAAK,CACTa,KAAM,QACNZ,MAAO,oBAxBS,+D,qBCvG1B,MAAMa,EAA2B,IAAgB,EAAQ,CAAC,CAAC,SAASC,KAErD","file":"js/chunk-2d228901.52a0049e.js","sourcesContent":["<template>\r\n  <div class=\"container py-5\">\r\n    <form\r\n      @submit.stop.prevent=\"handleSubmit\"\r\n    >\r\n      <div class=\"form-group\">\r\n        <label for=\"name\">Name</label>\r\n        <input\r\n          id=\"name\"\r\n          v-model=\"profile.name\"\r\n          type=\"text\"\r\n          name=\"name\"\r\n          class=\"form-control\"\r\n          placeholder=\"Enter Name\"\r\n          required\r\n        />\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label for=\"image\">Image</label>\r\n        <img\r\n          v-if=\"profile.image\" \r\n          :src=\"profile.image\" \r\n          class=\"d-block img-thumbnail mb-2\" \r\n          width=\"200\"\r\n          height=\"200\"\r\n        >\r\n        <input\r\n          id=\"image\"\r\n          type=\"file\"\r\n          name=\"image\"\r\n          accept=\"image/*\"\r\n          class=\"form-control-file\"\r\n          @change=\"handleFileChange\"\r\n\r\n        />\r\n      </div>\r\n\r\n      <button \r\n        type=\"submit\" \r\n        class=\"btn btn-primary\"\r\n        :disabled=\"isProcessing\"\r\n      >Submit</button>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport userAPI from './../apis/user'\r\nimport { Toast } from './../utils/helpers'\r\nimport { mapState } from 'vuex'\r\n\r\nexport default {\r\n  name: \"UserEdit\",\r\n  data() {\r\n    return {\r\n      profile: {\r\n        id: undefined,\r\n        image: '',\r\n        name: '',\r\n        email: ''\r\n      },\r\n      isProcessing: false\r\n    }\r\n  },\r\n  computed:{\r\n    ...mapState(['currentUser'])\r\n  },\r\n  // 判斷若使用者試圖從路由去修改其他使用者的資料，則轉址\r\n  beforeRouteUpdate (to, from, next) {\r\n    const { id } = to.params\r\n    if (id.toString() !== this.currentUser.id.toString()) {\r\n      this.$router.push({ name: 'not-found' })\r\n      return\r\n    }\r\n    this.setUser()\r\n    next()\r\n  },\r\n  created() {\r\n    const { id } = this.$route.params\r\n    if (id.toString() !== this.currentUser.id.toString()) {\r\n      this.$router.push({ name: 'not-found' })\r\n      return\r\n    }\r\n    this.setUser()\r\n  },\r\n  // 透過 watch 監控 currentUser 有無變化\r\n  watch: {\r\n    currentUser(){\r\n      this.setUser()\r\n    }\r\n  },\r\n  methods: {\r\n    setUser() {\r\n        const { name , image , email , id } = this.currentUser\r\n        this.profile = {\r\n          ...this.profile,\r\n          id,\r\n          email,\r\n          name,\r\n          image\r\n        }\r\n    },\r\n    handleFileChange(e) {\r\n      const { files } = e.target\r\n      const imgURL = window.URL.createObjectURL(files[0])\r\n      this.profile.image = imgURL\r\n    },\r\n    async handleSubmit(e) {\r\n      // 避免漏填\r\n      if(!this.profile.name){\r\n        Toast.fire({\r\n          type: 'warning',\r\n          title: '您尚未填寫姓名'\r\n        })\r\n        return\r\n      }\r\n      const form = e.target\r\n      const formData = new FormData(form)\r\n      try{\r\n        this.isProcessing = true\r\n        const { data , statusText } = await userAPI.update({ userId: this.profile.id , formData})\r\n        if (statusText !== 'OK' || data.status !== 'success') {\r\n          throw new Error(statusText)\r\n        }\r\n        // 更新完成後轉址到使用者詳細頁\r\n        this.$router.push({ name: 'user', params: { id: this.profile.id } })\r\n      }catch(error){\r\n        this.isProcessing = false\r\n        console.log('error' , error)\r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '無法更新使用者資料，請稍後再試'\r\n        })\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>","import { render } from \"./UserEdit.vue?vue&type=template&id=5efeb6e0\"\nimport script from \"./UserEdit.vue?vue&type=script&lang=js\"\nexport * from \"./UserEdit.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\user\\\\JackHuo\\\\WebDevelopment\\\\Project\\\\Vue\\\\forum-front-end-vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}